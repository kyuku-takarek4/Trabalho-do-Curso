<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Página Empresas</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="css/pag-empresas.css">
    <link rel="stylesheet" href="css/estilo.css">
</head>
<body class="lapis">
    <div class="corpo">
        <button id="perfil">
            <div><img id="tamanhoimagem" src="./imagens/image.png" alt="Imagem de Perfil"></div> 
        </button>

        <div class="descricao" id="margem">
            <p>Insira o link da imagem para atualizar seu perfil:</p>
            <input type="text" id="linkImagem" placeholder="Link da Imagem" required>
        </div>

        <div id="alterarDados"> 
            <ul class="descricao">
                <li><input type="text" id="nome" placeholder="Nome" required></li>
                <li><input type="text" id="telefone" placeholder="Telefone" required></li>
                <li><input type="text" id="endereco" placeholder="Endereço" required></li>
                <li><input type="text" id="cnpj" placeholder="CNPJ" required></li>
                <li><input type="text" id="representante" placeholder="Representante" required></li>
                <li><textarea id="descricao" placeholder="Descrição da Empresa..." required></textarea></li>
            </ul>
            <button id="alterar" onclick="alterarDados()">Alterar Dados</button>
            <div id="mensagemErro" style="display:none; color:red;"></div>
        </div>
    </div>

    <div class="menu">
        <ul class="ubuntu-light" id="sidebar">
            <div id="Configuracoes">
                <i>Configurações</i> 
            </div>
            <li id="Perfil-sidebar">
                <a id="estilodolink" href="./pag-empresas.html">Alterar Dados</a>
            </li>
            <li id="Empresas-sidebar">
                <a href="">Privacidade</a>
            </li>
            <li>
                <a href="">Suporte</a>
            </li>
            <li>
                <a href="./login.html">Sair</a>
            </li>
        </ul>
    </div>

    <div id="esponsividade">
        <div id="estrutura"></div>
    </div>
    <p id="infoUsuario">Carregando informações do usuário...</p>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const userID = localStorage.getItem("userID"); // Recupera o ID do usuário do localStorage

            // Função para carregar as informações da empresa
            function carregarDadosEmpresa() {
                fetch(`http://localhost:3000/api/usuarios/${userID}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erro ao carregar os dados da empresa.");
                    }
                    return response.json();
                })
                .then(data => {
                    // Preenche os placeholders com as informações da empresa
                    document.getElementById("nome").value = data.nome || '';
                    document.getElementById("telefone").value = data.telefone || '';
                    document.getElementById("endereco").value = data.endereco || '';
                    document.getElementById("cnpj").value = data.cnpj || '';
                    document.getElementById("representante").value = data.representante || '';
                    document.getElementById("descricao").value = data.descricao || '';  // Preenche a descrição
                    document.getElementById("tamanhoimagem").src = data.imagem || './imagens/image.png';  // Atualiza a imagem de perfil
                })
                .catch(error => {
                    console.error(error.message);
                });
            }

            // Chama a função para carregar os dados ao iniciar a página
            carregarDadosEmpresa();

            // Função para atualizar a imagem de perfil
            document.getElementById("linkImagem").addEventListener("input", function() {
                const linkImagem = document.getElementById("linkImagem").value;

                if (linkImagem) {
                    // Atualiza a imagem do perfil
                    document.getElementById("tamanhoimagem").src = linkImagem;

                    // Aqui você pode também fazer uma requisição para atualizar a URL da imagem no banco de dados
                    fetch(`http://localhost:3000/api/usuarios/${userID}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ imagem: linkImagem })  // Envia o novo link da imagem
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Erro ao atualizar a imagem.");
                        }
                        console.log("Imagem atualizada com sucesso.");
                    })
                    .catch(error => {
                        console.error("Erro ao atualizar a imagem:", error.message);
                    });
                }
            });

            // Função para atualizar os dados da empresa
            window.alterarDados = function() {
                const nome = document.getElementById("nome").value;
                const telefone = document.getElementById("telefone").value;
                const endereco = document.getElementById("endereco").value;
                const cnpj = document.getElementById("cnpj").value;
                const representante = document.getElementById("representante").value;
                const descricao = document.getElementById("descricao").value;

                // Enviar os dados atualizados para o servidor
                fetch(`http://localhost:3000/api/usuarios/${userID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome: nome,
                        telefone: telefone,
                        endereco: endereco,
                        cnpj: cnpj,
                        representante: representante,
                        descricao: descricao
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erro ao atualizar os dados.");
                    }
                    console.log("Dados atualizados com sucesso.");
                    // Aqui você pode exibir uma mensagem de sucesso ao usuário
                })
                .catch(error => {
                    console.error("Erro ao atualizar os dados:", error.message);
                });
            };
        });
    </script>
</body>
</html>
