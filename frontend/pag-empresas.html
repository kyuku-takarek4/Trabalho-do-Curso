<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Página Empresas</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="css/pag-empresas.css">
    <link rel="stylesheet" href="css/estilo.css">
</head>
<body class="lapis">
    <div class="corpo">
        <div id="perfil">
            <div><img id="tamanhoimagem" src="./imagens/image.png"></div> 
        </div>

        <div class="descricao">
            <textarea class="texto-sidebar" id="nome" placeholder="Nome do Usuário..."></textarea>
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 485.219 485.22">
                    <g>
                        <path d="M467.476,146.438l-21.445,21.455L317.35,39.23l21.445-21.457c23.689-23.692,62.104-23.692,85.795,0l42.886,42.897 C491.133,84.349,491.133,122.748,467.476,146.438z M167.233,403.748c-5.922,5.922-5.922,15.513,0,21.436 c5.925,5.955,15.521,5.955,21.443,0L424.59,189.335l-21.469-21.457L167.233,403.748z M60,296.54c-5.925,5.927-5.925,15.514,0,21.44 c5.922,5.923,15.518,5.923,21.443,0L317.35,82.113L295.914,60.67L60,296.54z M338.767,103.54L102.881,339.421 c-11.845,11.822-11.815,31.041,0,42.886c11.85,11.846,31.038,11.901,42.914-0.032l235.886-235.837L338.767,103.54z M145.734,446.572c-7.253-7.262-10.749-16.465-12.05-25.948c-3.083,0.476-6.188,0.919-9.36,0.919 c-16.202,0-31.419-6.333-42.881-17.795c-11.462-11.491-17.77-26.687-17.77-42.887c0-2.954,0.443-5.833,0.859-8.703 c-9.803-1.335-18.864-5.629-25.972-12.737c-0.682-0.677-0.917-1.596-1.538-2.338L0,485.216l147.748-36.986 C147.097,447.637,146.36,447.193,145.734,446.572z"/>
                    </g>
                </svg>
            </div>
        </div>

        <div id="alterarDados" class="descricao"> 
            <h3>Alterar Dados da Empresa</h3>
            <input type="text" id="nome" placeholder="Nome" required>
            <input type="text" id="telefone" placeholder="Telefone" required>
            <input type="text" id="endereco" placeholder="Endereço" required>
            <input type="text" id="cnpj" placeholder="CNPJ" required>
            <input type="text" id="representante" placeholder="Representante" required>
            <textarea id="descricao" placeholder="Descrição da Empresa..." required></textarea>
            <button onclick="alterarDados()">Alterar Dados</button>
            <div id="mensagemErro" style="display:none; color:red;"></div>
        </div>
    </div>

    <div class="menu">
        <ul class="ubuntu-light" id="sidebar">
            <div id="Configuracoes">
                <i>Configurações</i> 
            </div>
            <li id="Perfil-sidebar">
                <a id="estilodolink" href="https://youtu.be/PwBeBIvxSRw">Alterar Dados</a>
            </li>
            <li id="Empresas-sidebar">
                <a href="">Empresa</a>
            </li>
            <li>
                <a href="">teste</a>
            </li>
            <li>
                <a href="">teste</a>
            </li>
        </ul>
    </div>

    <div id="esponsividade">
        <div id="estrutura"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const usuario = JSON.parse(localStorage.getItem('usuario'));
    if (usuario) {
        // Puxar os dados do banco de dados com o ID do usuário
        fetch(`http://localhost:3000/api/usuarios/${usuario.id}`)
        .then(resposta => {
            if (!resposta.ok) throw new Error('Erro ao obter dados do usuário.');
            return resposta.json();
        })
        .then(dados => {
            // Preencher os campos com os dados obtidos
            document.getElementById('nome').value = dados.nome;
            document.getElementById('telefone').value = dados.telefone;
            document.getElementById('endereco').value = dados.endereco;
            document.getElementById('cnpj').value = dados.cnpj;
            document.getElementById('representante').value = dados.representante;
            document.getElementById('descricao').value = dados.descricao; // Novo campo
        })
        .catch(error => {
            console.error(error);
            mostrarMensagemErro('Erro ao carregar os dados do usuário.');
        });
    }
});

        function alterarDados() {
            const nome = document.getElementById('nome').value;
            const telefone = document.getElementById('telefone').value;
            const endereco = document.getElementById('endereco').value;
            const cnpj = document.getElementById('cnpj').value;
            const representante = document.getElementById('representante').value;
            const descricao = document.getElementById('descricao').value;

            // Validação dos campos
            if (!nome || !telefone || !endereco || !cnpj || !representante || !descricao) {
                mostrarMensagemErro('Por favor, preencha todos os campos.');
                return;
            }

            const dadosAtualizacao = { nome, telefone, endereco, cnpj, representante, descricao };
            const id = JSON.parse(localStorage.getItem('usuario')).id; // Pegar o ID do usuário

            fetch(`http://localhost:3000/api/usuarios/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dadosAtualizacao)
            })
            .then(resposta => {
                if (!resposta.ok) throw new Error('Erro ao alterar os dados.');
                return resposta.json();
            })
            .then(() => {
                alert('Dados alterados com sucesso!');
            })
            .catch(error => {
                mostrarMensagemErro(error.message);
            });
        }

        function mostrarMensagemErro(mensagem) {
            const mensagemErro = document.getElementById('mensagemErro');
            mensagemErro.textContent = mensagem;
            mensagemErro.style.display = 'block';
        }
    </script>
</body>
</html>